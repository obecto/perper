syntax = "proto2";

option java_multiple_files = true;
option java_package = "com.obecto.perper.protobuf";
option csharp_namespace = "Perper.Protocol.Protobuf";

package perper;

service Fabric {
  rpc StreamTriggers (StreamTriggerFilter) returns (stream StreamTrigger) {}
  rpc WorkerTriggers (WorkerTriggerFilter) returns (stream WorkerTrigger) {}
  rpc StreamNotifications (StreamNotificationFilter) returns (stream StreamNotification) {}
}

message StreamTriggerFilter {
    optional string delegate = 1;
}

message StreamTrigger {
    required string delegate = 1;
    required string stream = 2;
}

message WorkerTriggerFilter {
    optional string workerDelegate = 1;
}

message WorkerTrigger {
    required string workerDelegate = 1;
    required string stream = 2;
    required string worker = 3;
}

message StreamNotificationFilter {
    required string stream = 1;
}

message StreamNotification {
    required string stream = 1;
    required int64 notificationKey = 2;

    oneof affinity {
      string stringAffinity = 3;
      int64 intAffinity = 4;
    }
}
