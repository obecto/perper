syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.obecto.perper.protobuf";
option csharp_namespace = "Perper.Protocol.Protobuf";

package perper;

import "google/protobuf/empty.proto";

service Fabric {
    rpc CallTriggers (NotificationFilter) returns (stream CallTrigger) {}
    rpc CallFinished (CallFilter) returns (google.protobuf.Empty) {}
    rpc StreamTriggers (NotificationFilter) returns (stream StreamTrigger) {}
    rpc StreamItems (StreamItemsRequest) returns (stream StreamItemsResponse) {}
}

message NotificationFilter {
    string agent = 1;
    string instance = 2;
    //string delegate = 3;
    //string execution = 4;
}

message CallFilter {
    string call = 4;
}

message StreamItemsRequest {
    string stream = 1;
    int64 startKey = 2;
    bool localToData = 3;
    int64 stride = 4; // 0 if unknown, 1.. to wait for stream items
}

message StreamItemsResponse {
    int64 key = 1;
}

message CallTrigger {
    //string agent = 1;
    // Can probably remove instance and delegate (99% the agent will be reading the call data for parameters)
    string instance = 2;
    string delegate = 3;
    string call = 4;
    //bool canceled = 5;
}

message StreamTrigger {
    //string agent = 1;
    // Can probably remove instance and delegate (99% the agent will be reading the call data for parameters)
    string instance = 2;
    string delegate = 3;
    string stream = 4;
}
